name 'gnutls'
org 'amylum'

deps(
  gmp: '6.1.2-1',
  nettle: '3.3-6',
  libtasn1: '4.12-1',
  autogen: '5.18.12-11',
  'p11-kit': '0.23.2-7',
  guile: '2.2.2-1',
  gc: '7.6.0-18',
  libunistring: '0.9.7-1',
  libffi: '3.2.1-4',
  libtool: '2.4.6-2',
  zlib: '1.2.11-1',
  libidn: '1.33-2'
)

patch 'gperf.patch'

configure_flags(
  prefix: '/usr',
  'disable-rpath': nil,
  'disable-doc': nil,
  'disable-cxx': nil,
  'enable-guile': nil,
  'with-guile-site-dir': 'no',
  'with-zlib': nil,
  'with-libz-prefix': "#{dep(:zlib)}/usr",
  'with-libunistring-prefix': "#{dep(:libunistring)}/usr",
  build: 'x86_64-pc-linux-gnu',
  host: 'x86_64-unknown-linux-gnu'
)
remove_linker_archives
remove_pkgconfig_files

cflags
harden

build do
  run "ln -s #{dep(:libffi)}/usr/lib/libffi-3.2.1/include/ #{dep(:libffi)}/usr/include"
  run 'make bootstrap'
  configure
  make
  install
end

test do
  # TODO: add tests
end
